#!/bin/bash

set -euo pipefail

# load env vars
if [ -f .env ]; then
  export $(cat .env | sed 's/#.*//g' | xargs)
fi

base_path=$HOME/.notes

function help() {
echo
echo "A note task runner for $base_path"
echo
}

function find() {
    local file=$(tree -if $base_path | cut -d'/' -f5- | fzf --preview 'bat --style=numbers  $base_path{}')

    echo "$file"
    echo

    if [[ $file =~ (^"snippets") ]]; then
        bat --style plain --theme GitHub $base_path/$file
    else
        glow $base_path/$file -s $HOME/.glamour.json
    fi
}

function edit() {
    local file=$(tree -if $base_path | cut -d'/' -f5- | fzf --preview 'bat --style=numbers  $base_path{}')

     $EDITOR "$base_path/$file"
}

function new() {
     $EDITOR "$base_path/$1"
}

function list() {
    tree -if $base_path
}

case "$1" in
    find)
        find
        ;;
    list)
        list
        ;;
    edit)
        edit
        ;;
    new)
        new $2
        ;;
    *)
        help task
        exit 1
esac